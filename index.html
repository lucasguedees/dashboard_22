
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard 22º BPM</title>
    
    <!-- Tailwind CSS (Usando via CDN com configuração segura para o navegador) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#3b82f6",
              secondary: "#10b981",
              background: "#030712",
              card: "#111827"
            }
          }
        }
      }
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #030712; margin: 0; padding: 0; color: #f3f4f6; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }
        @media print { .no-print { display: none !important; } }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .animate-shake { animation: shake 0.2s ease-in-out 0s 2; }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "recharts": "https://esm.sh/recharts@2.12.7",
    "@google/genai": "https://esm.sh/@google/genai@1.3.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-gray-950">
    <div id="root">
        <div class="h-screen flex items-center justify-center bg-gray-950">
            <div class="flex flex-col items-center gap-4">
                <div class="w-10 h-10 border-4 border-blue-500/20 border-t-blue-500 rounded-full animate-spin"></div>
                <p class="text-blue-500 text-xs font-bold uppercase tracking-widest">Iniciando Dashboard 22º BPM...</p>
            </div>
        </div>
    </div>

    <!-- 
      Usamos type="text/babel" com data-type="module" para permitir o uso de imports 
      do importmap acima sem que o navegador tente resolver arquivos locais .tsx.
    -->
    <script type="text/babel" data-presets="react,typescript" data-type="module">
        import React, { useState, useEffect, useCallback, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
          LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, 
          BarChart, Bar, Legend, LabelList 
        } from 'recharts';
        import { GoogleGenAI } from "@google/genai";

        // --- CONSTANTS ---
        const CITIES = [
          "Arroio do Meio", "Canudos do Vale", "Capitão", "Coqueiro Baixo", 
          "Cruzeiro do Sul", "Doutor Ricardo", "Encantado", "Forquetinha", 
          "Lajeado", "Marques de Souza", "Muçum", "Nova Bréscia", 
          "Pouso Novo", "Progresso", "Relvado", "Roca Sales", 
          "Santa Clara do Sul", "Sério", "Travesseiro", "Vespasiano Correa"
        ].sort();

        const MONTHS = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

        const ShieldIcon = ({ className = "w-12 h-12" }) => (
          <svg viewBox="0 0 24 24" fill="none" className={className}>
            <path d="M12 2L3 7V11C3 15.11 6.84 19.43 12 22C17.16 19.43 21 15.11 21 11V7L12 2Z" fill="currentColor" />
            <path d="M12 5V19M12 5L9 8M12 5L15 8" stroke="white" strokeWidth="1" strokeLinecap="round" opacity="0.5" />
          </svg>
        );

        // --- MAIN APPLICATION COMPONENT ---
        const App = () => {
          const [user, setUser] = useState(null);
          const [activeView, setActiveView] = useState('HOME');
          const [isInitializing, setIsInitializing] = useState(true);

          useEffect(() => {
            // Inicializar usuários padrão se não existirem
            const savedUsers = localStorage.getItem('22bpm_users_list');
            if (!savedUsers) {
              localStorage.setItem('22bpm_users_list', JSON.stringify([
                { id: '1', username: 'admin', role: 'ADMIN', rank: 'Ten Cel', password: '22' },
                { id: '2', username: 'comando', role: 'COMANDO', rank: 'Maj', password: '22' }
              ]));
            }

            // Tentar recuperar sessão
            const session = localStorage.getItem('22bpm_user');
            if (session) setUser(JSON.parse(session));
            setIsInitializing(false);
          }, []);

          const handleLogin = (u) => {
            setUser(u);
            localStorage.setItem('22bpm_user', JSON.stringify(u));
          };

          const handleLogout = () => {
            setUser(null);
            localStorage.removeItem('22bpm_user');
          };

          if (isInitializing) return null;

          if (!user) {
            return (
              <div className="h-screen flex items-center justify-center p-4">
                <div className="w-full max-w-md bg-gray-900 border border-gray-800 rounded-3xl p-8 shadow-2xl text-center">
                  <ShieldIcon className="w-20 h-20 text-blue-600 mx-auto mb-6" />
                  <h1 className="text-2xl font-black text-white uppercase mb-8">SIOP 22º BPM</h1>
                  <form onSubmit={(e) => {
                    e.preventDefault();
                    const username = e.target.username.value;
                    const password = e.target.password.value;
                    const users = JSON.parse(localStorage.getItem('22bpm_users_list'));
                    const found = users.find(u => u.username === username && u.password === password);
                    if (found) handleLogin(found); else alert('Credenciais inválidas');
                  }} className="space-y-4">
                    <input name="username" placeholder="Usuário" className="w-full bg-gray-800 p-4 rounded-xl outline-none border border-gray-700 focus:border-blue-500" required />
                    <input name="password" type="password" placeholder="Senha" className="w-full bg-gray-800 p-4 rounded-xl outline-none border border-gray-700 focus:border-blue-500" required />
                    <button className="w-full bg-blue-600 py-4 rounded-xl font-bold uppercase hover:bg-blue-500 transition-colors">Acessar Sistema</button>
                  </form>
                </div>
              </div>
            );
          }

          return (
            <div className="flex h-screen bg-gray-950 text-gray-100">
              {/* Sidebar */}
              <aside className="w-64 bg-gray-900 border-r border-gray-800 flex flex-col hidden md:flex">
                <div className="p-6 border-b border-gray-800 flex items-center gap-3">
                  <ShieldIcon className="w-8 h-8 text-blue-600" />
                  <span className="font-black text-white">22º BPM</span>
                </div>
                <nav className="flex-1 p-4 space-y-2">
                  {['HOME', 'AIT_DASHBOARD', 'PRODUCTIVITY_DASHBOARD'].map(view => (
                    <button 
                      key={view}
                      onClick={() => setActiveView(view)}
                      className={`w-full text-left p-3 rounded-xl text-sm font-bold uppercase tracking-wider ${activeView === view ? 'bg-blue-600 text-white' : 'text-gray-500 hover:bg-gray-800'}`}
                    >
                      {view.replace('_', ' ')}
                    </button>
                  ))}
                </nav>
                <div className="p-4 border-t border-gray-800">
                  <p className="text-[10px] text-gray-500 mb-2 uppercase font-bold">{user.rank} {user.username}</p>
                  <button onClick={handleLogout} className="text-red-500 text-xs font-bold uppercase hover:underline">Sair do Sistema</button>
                </div>
              </aside>

              {/* Main Content */}
              <main className="flex-1 overflow-y-auto p-8">
                {activeView === 'HOME' && (
                  <div className="h-full flex flex-col items-center justify-center text-center">
                    <ShieldIcon className="w-32 h-32 text-blue-600 mb-8 opacity-20" />
                    <h1 className="text-4xl font-black uppercase text-white mb-2">SIOP / 22º BPM</h1>
                    <p className="text-gray-500 max-w-md">Selecione um módulo na barra lateral para gerenciar os dados operacionais.</p>
                  </div>
                )}
                {activeView !== 'HOME' && (
                  <div className="p-12 border-2 border-dashed border-gray-800 rounded-3xl text-center text-gray-600">
                    <p className="font-mono text-xs uppercase tracking-widest">Módulo em Processamento para Renderização...</p>
                  </div>
                )}
              </main>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
